version: 1.2.{build}
image: Visual Studio 2015
install:
- cmd: >-
    set QTDIR=C:\Qt\5.11.1\mingw53_32

    set PATH=%QTDIR%\bin;C:\cygwin;C:\cygwin64;C:\MinGW\bin;%PATH%;
build_script:
- cmd: >-
    qmake MiniGrapher.pro

    mingw32-make release

    mingw32-make clean

    cd release

    windeployqt MiniGrapher.exe

    copy /y "C:\projects\minigrapher\Src\libstdc++-6.dll" "C:\projects\minigrapher\release\libstdc++-6.dll"
test_script:
- cmd: >-
    cd Test

    qmake MiniGrapher_Test.pro

    mingw32-make release

    mingw32-make clean

    cd release

    windeployqt MiniGrapher.exe

    copy /y "C:\projects\minigrapher\Src\libstdc++-6.dll" "C:\projects\minigrapher\Test\release\libstdc++-6.dll"

    MiniGrapher.exe
artifacts:
- path: release/
  name: MiniGrapher
  type: WebDeployPackage