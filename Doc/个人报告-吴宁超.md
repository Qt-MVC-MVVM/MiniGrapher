# 个人报告-吴宁超

### 个人分工

在这次的项目开发中，我担任组长，个人完成的任务如下：

- 进行分工协调，MVVM框架的搭建以及Appveyor持续集成环境的搭建
- 负责View层中给定横纵坐标数据的函数图像的绘制和显示、微分积分结果的显示
- 负责App层的组装、单元测试代码的编写，以生成可以发布执行的应用程序

#### MVVM框架的搭建

MVVM框架的建立首先需要理解MVVM框架。我首先通过查阅文档资料对MVVM框架有了整体的认识，然后再通过阅读几个利用MVVM框架搭建的工程项目的源代码进一步理解了MVVM框架。

在我们的项目中，框架搭建如下：

##### App层

- 实现ViewModel和Model、View和ViewModel之间的绑定
- 将Model层的数据暴露给View层
- 整合生成完整可运行的应用程序

##### View层

- 用户界面的显示与交互
- 将Model层处理产生的数据以函数图像或微分、积分结果的形式呈现给使用者
- 命令执行完毕信号的接收器
- 属性改变信号的接收器

##### ViewModel层

- 含有绘图、微分、积分等命令
- 命令执行完毕信号的发生器
- 属性改变信号的接收器以及发生器

##### Model层

- x、y坐标，微分积分结果等数据的存储
- 负责调用Algorithm层相关函数进行数据的计算与处理

##### Algorithm层

- 负责数据计算与处理相关算法的实现，并提供接口给Model层调用

#### Appveyor持续集成环境的搭建

由于之前有过一些Linux的shell编程基础，所以在Appveyor上使用cmd进行编译等命令的编写还算顺利，仅有的几个问题都出现在环境变量的未正确配置上，在参考官方文档后得以解决。

主要的appveyor环境变量的配置以及编译命令如下：

```yaml
image: Visual Studio 2015
install:
- cmd: >-
    set QTDIR=C:\Qt\5.11.1\mingw53_32
    set PATH=%QTDIR%\bin;C:\cygwin;C:\cygwin64;C:\MinGW\bin;%PATH%;
build_script:
- cmd: >-
    qmake MiniGrapher.pro
    mingw32-make release
    mingw32-make clean
    cd release
    windeployqt MiniGrapher.exe
    copy /y "C:\projects\minigrapher\Src\libstdc++-6.dll" "C:\projects\minigrapher\release\libstdc++-6.dll"
```

最后一个复制命令是因为appveyor自动生成的dll文件与可执行程序不匹配，造成程序无法运行，所以用本机可运行的dll文件覆盖自动生成的dll文件。

#### View层中函数图像的绘制和显示

- 函数图像的绘制利用了`QCustomPlot`库

- View层函数绘制命令触发后将函数解析式、下界、上界分别以`std::string`, `double`, `double`的形式传给ViewModel，ViewModel再传给Model
- Model在进行数据计算后，对两个`QVector`类型的数组进行赋值，这两个数组分别代表横坐标和对应的纵坐标，发出属性改变的通知
- View层在接收到属性改变的通知后对View层的函数图像进行绘制

#### View层中微分积分结果的显示

- View层函数微分、积分的命令与函数绘制命令同时触发
- 微分以函数的下界作为横坐标进行计算
- 积分以函数的下界和上届为区间进行计算
- 在View层接收到属性改变的通知后会在UI的指定区域显示出微分值和积分值

#### 单元测试代码的编写

##### 测试原理

- 测试利用了Qt的 `QTest` 库，将`ViewModel`、`Model`、`Algorithm`层的数据整合进行测试
- 测试代码中共有11个测试函数，测试函数覆盖：
  - 一次函数
  - 二次函数
  - 三次函数
  - 正弦函数
  - 余弦函数
  - 正切函数
  - 常用对数函数
  - 自然对数函数
  - 绝对值函数
  - 开方函数
  - 复合函数
- 在每一个测试函数中，分以下三步进行测试：
  - 测试x，y的关系在误差范围内是否满足函数关系式
  - 测试函数定积分计算是否在误差范围之内
  - 测试函数微分计算是否在误差范围之内
- 误差范围设置为`1e-3`

##### 测试结果

- 测试截图如下：

![Test_Result](https://github.com/CcCody/MiniGrapher/raw/master/Images/Test_Result.png)

- 详细测试信息可以在[Appveyor页面](https://ci.appveyor.com/project/CcCody/minigrapher-unifv)查看，由于项目前期建立的是私有仓库，所以这个页面只包含最近几次的含测试信息的内容。

#### App层的组装

App层代码的编写，核心是

- 实现ViewModel和Model、View和ViewModel之间的绑定；
- 将ViewModel层的命令暴露给View层；
- 将Model层的数据暴露给View层；
- 将View层的接收器挂到Common层接收器数组中

### 个人心得

- 这次课程是个人第一次接触MVVM框架以及持续集成等概念，真正体会到了生产效率相比于传统方式的提高，收获颇丰；
- 完成这个工程实践后对MVVM框架有了更深刻清晰的认识，对MVVM框架对于各模块解耦的作用也有了切身的认识与体会；
- 持续集成自动化的编译与部署对于团队开发而言是一个很好的方式，不仅能尽可能早地发现错误，也能在自动化部署等方面节省团队的大量时间。
- 单元测试同样也是尽早发现错误的一种很好的途径，我们也在单元测试的过程中修复了不少没有被意识到的小错误。

### 课程建议

课程的核心及难点其实在于MVVM框架、单元测试等概念的理解与掌握，网上能够检索到的资料水平参差不齐，不利于初学者掌握。老师可以考虑在学生已经经历了一两天项目的开发实践之后再细致地对MVVM框架等相关知识进行一次系统的讲解，如果能够提供一些优秀的代码示例供学生理解消化可能会有更好的效果。